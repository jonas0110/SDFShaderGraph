/*! litegraph 23-02-2015 */
function LGraph1ParamNode(){this.addOutput("result","notype",this.getOutputTypes(),this.getOutputExtraInfo()),this.addInput("A","notype",this.getInputTypes(),this.getInputExtraInfo()),this.shader_piece=LiteGraph.CodeLib[this.getCodeName()]}function LGraph2ParamNode(){this.addOutput("Result","",this.getOutputTypes(),this.getOutputExtraInfo()),this.addInput("A","",this.getInputTypesA(),this.getInputExtraInfoA()),this.addInput("B","",this.getInputTypesB(),this.getInputExtraInfoB()),this.shader_piece=LiteGraph.CodeLib[this.getCodeName()]}function LGraph3ParamNode(){this.addOutput("Result","",this.getOutputTypes(),this.getOutputExtraInfo()),this.addInput("A","",this.getInputTypesA(),this.getInputExtraInfoA()),this.addInput("B","",this.getInputTypesB(),this.getInputExtraInfoB()),this.addInput("C","",this.getInputTypesC(),this.getInputExtraInfoC()),this.shader_piece=LiteGraph.CodeLib[this.getCodeName()]}function LGraphConstant(){this.addOutput("value","number",{number:1}),this.properties={value:1},this.editable={property:"value",type:"number"},this.shader_piece=new PConstant("float")}function LGraphTime(){this.addOutput("time","number",{number:1}),this.shader_piece=PTime}function LGraphConstVec2(){this.addOutput("value","vec2",{vec2:1}),this.properties={v1:1,v2:1},this.shader_piece=new PConstant("vec2")}function LGraphConstVec3(){this.addOutput("value","vec3",{vec3:1}),this.properties={v1:1,v2:1,v3:1},this.editable={property:"value",type:"vec3"},this.shader_piece=new PConstant("vec3")}function LGraphConstVec4(){this.addOutput("value","vec4",{vec4:1}),this.properties={v1:1,v2:1,v3:1,v4:1},this.editable={property:"value",type:"vec4"},this.shader_piece=new PConstant("vec4")}function LGraphCamToPixelWS(){this.addOutput("Camera To Pixel","vec3",{vec3:1}),this.shader_piece=PCameraToPixelWS}function LGraphPixelNormalWS(){this.addOutput("Pixel Normal","vec3",{vec3:1}),this.shader_piece=PPixelNormalWS}function LGraphUVs(){this.addOutput("UVs","vec2",{vec2:1}),this.properties={UTiling:1,VTiling:1},this.options={UTiling:{min:0,max:1,step:.01},VTiling:{min:0,max:1,step:.01}},this.shader_piece=PUVs}function LGraphVertexPosWS(){this.addOutput("vec3","vec3",{vec3:1}),this.shader_piece=PVertexPosWS}function LGraphShader(){this.uninstantiable=!0,this.addInput("color","vec4",{vec4:1}),this.addInput("normal","vec3",{vec3:1}),this.addInput("world position offset","vec3",{vec3:1}),this.size=[125,250],this.shader_piece=ShaderConstructor}function LGraphTexturePreview(){this.addInput("Texture","Texture",{Texture:1,Vec3:1,Vec4:1}),this.properties={flipY:!1},this.size=[LGraphTexture.image_preview_size,LGraphTexture.image_preview_size]}function LGraphTexture(){this.addOutput("Texture","Texture",{Texture:1}),this.addOutput("Color","vec4",{vec4:1}),this.addOutput("R","float",{"float":1}),this.addOutput("G","float",{"float":1}),this.addOutput("B","float",{"float":1}),this.addOutput("A","float",{"float":1}),this.addInput("UVs","vec2",{vec2:1}),this.properties=this.properties||{},this.properties.name="",this.size=[170,165],this.shader_piece=PTextureSample}function LGraphCubemap(){this.addOutput("Cubemap","Cubemap"),this.addOutput("Color","vec4",{vec4:1}),this.addInput("vec3","vec3"),this.properties=this.properties||{},this.properties.name="",this.size=[LGraphTexture.image_preview_size,LGraphTexture.image_preview_size],this.shader_piece=PTextureSampleCube,this.size=[170,165]}function LGraphVecToComps(){this.addInput("vec","vec4",{vec4:1,vec3:1,vec2:1}),this.addOutput("x","number",{"float":1}),this.addOutput("y","number",{"float":1}),this.addOutput("z","number",{"float":1}),this.addOutput("v","number",{"float":1})}function LGraphAbs(){this.code_name="abs",this.output_types={"float":1,vec3:1,vec4:1,vec2:1},this.intput_types={"float":1,vec3:1,vec4:1,vec2:1},this.output_type="float",LGraph1ParamNode.call(this),console.log(this)}function LGraphCos(){this.code_name="cos",this.output_types={"float":1,vec3:1,vec4:1,vec2:1},this.intput_types={"float":1,vec3:1,vec4:1,vec2:1},this.output_type="float",LGraph1ParamNode.call(this),console.log(this)}function LGraphSin(){this._ctor(LGraphSin.title),this.code_name="sin",this.output_types=null,this.out_extra_info={types_list:{"float":1,vec3:1,vec4:1,vec2:1},use_t:1},this.intput_types=null,this.in_extra_info={types_list:{"float":1,vec3:1,vec4:1,vec2:1},use_t:1},LGraph1ParamNode.call(this)}function LGraphOperation(){this._ctor(LGraphOperation.title),this.output_types=null,this.out_extra_info={types_list:{"float":1,vec3:1,vec4:1,vec2:1},use_t:1},this.intput_typesA=null,this.in_extra_infoA={types_list:{"float":1,vec3:1,vec4:1,vec2:1},use_t:1},this.intput_typesB=null,this.in_extra_infoB={types_list:{"float":1,vec3:1,vec4:1,vec2:1},use_t:1},this.number_piece=new PConstant("float"),this.properties={A:0,B:0},LGraph2ParamNode.call(this)}function LGraphAddOp(){this._ctor(LGraphAddOp.title),this.code_name="add",LGraphOperation.call(this)}function LGraphMix(){this._ctor(LGraphMix.title),this.code_name="mix",LGraph3ParamNode.call(this)}function LGraphMixer(){this.addOutput("Result","vec4",{vec4:1,vec3:1}),this.addInput("A","vec3",{vec4:1,vec3:1,"float":1}),this.addInput("B","vec3",{vec4:1,vec3:1,"float":1}),this.addInput("alpha","number",{"float":1,number:1}),this.properties={alpha:.5},this.options={alpha:{min:0,max:1,step:.01}},this.shader_piece=LiteGraph.CodeLib.mix}function LGraphMulOp(){this.code_name="mul",this.output_types=null,this.out_extra_info={types_list:{"float":1,vec3:1,vec4:1,vec2:1},use_t:1},this.intput_typesA=null,this.in_extra_infoA={types_list:{"float":1,vec3:1,vec4:1,vec2:1},use_t:1},this.intput_typesB=null,this.in_extra_infoB={types_list:{"float":1,vec3:1,vec4:1,vec2:1},use_t:1},this.number_piece=new PConstant("float"),this.properties={A:0,B:0},LGraphOperation.call(this)}function LGraphReflect(){this.addOutput("reflect vector","vec3",{vec3:1}),this.addInput("normal","vec3",{vec3:1}),this.addInput("vector","vec3",{vec3:1}),this.shader_piece=LiteGraph.CodeLib.reflect}function LGraphSmooth(){this.addOutput("Result","float",{"float":1}),this.addInput("lower","float",{"float":1}),this.addInput("upper","float",{"float":1}),this.addInput("x","float",{"float":1}),this.properties={lower:0,upper:1.5},this.shader_piece=PSmooth}LGraph1ParamNode.prototype.constructor=LGraph1ParamNode,LGraph1ParamNode.prototype.onExecute=function(){this.processInputCode()},LGraph1ParamNode.prototype.processInputCode=function(){var a=this.getInputCode(0);if(a){var b=this.codes[0]=this.shader_piece.getCode(this.getCodeName()+"_"+this.id,a.getOutputVar(),this.getScope(),this.getOutputType());b.order=this.order,b.merge(a)}},LGraph1ParamNode.prototype.getOutputType=function(){var a=this.output_types?this.output_types:this.T_types;return Object.keys(a)[0]},LGraph1ParamNode.prototype.getOutputTypes=function(){return this.output_types?this.output_types:this.T_types},LGraph1ParamNode.prototype.getInputTypes=function(){return this.intput_types?this.intput_types:this.T_types},LGraph1ParamNode.prototype.getScope=function(){return CodePiece.FRAGMENT},LGraph1ParamNode.prototype.getCodeName=function(){return this.code_name},LGraph1ParamNode.prototype.getInputExtraInfo=function(){return this.in_extra_info},LGraph1ParamNode.prototype.getOutputExtraInfo=function(){return this.out_extra_info},LGraph2ParamNode.prototype.constructor=LGraph2ParamNode,LGraph2ParamNode.prototype.onExecute=function(){this.processInputCode()},LGraph2ParamNode.prototype.processInputCode=function(){var a=LiteGraph.EMPTY_CODE,b=this.getInputCode(0)||this.onGetNullCode(0),c=this.getInputCode(1)||this.onGetNullCode(1);b&&c&&(a=this.codes[0]=this.shader_piece.getCode(this.getCodeName()+"_"+this.id,b.getOutputVar(),c.getOutputVar(),this.getScope(),this.getOutputType()),a.order=this.order,a.merge(b),a.merge(c))},LGraph2ParamNode.prototype.getOutputTypes=function(){return this.output_types?this.output_types:this.T_types},LGraph2ParamNode.prototype.getInputTypesA=function(){return this.intput_typesA?this.intput_typesA:this.T_types},LGraph2ParamNode.prototype.getInputTypesB=function(){return this.intput_typesB?this.intput_typesB:this.T_types},LGraph2ParamNode.prototype.getOutputType=function(){var a=this.output_types?this.output_types:this.T_types;return Object.keys(a)[0]},LGraph2ParamNode.prototype.getScope=function(){return CodePiece.FRAGMENT},LGraph2ParamNode.prototype.getCodeName=function(){return this.code_name},LGraph2ParamNode.prototype.getInputExtraInfoA=function(){return this.in_extra_infoA},LGraph2ParamNode.prototype.getInputExtraInfoB=function(){return this.in_extra_infoB},LGraph2ParamNode.prototype.getOutputExtraInfo=function(){return this.out_extra_info},LGraph3ParamNode.prototype.constructor=LGraph3ParamNode,LGraph3ParamNode.prototype.onExecute=function(){this.processInputCode()},LGraph3ParamNode.prototype.processInputCode=function(){var a=LiteGraph.EMPTY_CODE,b=this.getInputCode(0)||this.onGetNullCode(0),c=this.getInputCode(1)||this.onGetNullCode(1),d=this.getInputCode(2)||this.onGetNullCode(2);b&&c&&d&&(a=this.codes[0]=this.shader_piece.getCode(this.getCodeName()+"_"+this.id,b.getOutputVar(),c.getOutputVar(),d.getOutputVar(),this.getScope(),this.getOutputType()),a.order=this.order,d&&a.merge(d),a.merge(b),a.merge(c))},LGraph3ParamNode.prototype.getOutputTypes=function(){return this.output_types?this.output_types:this.T_types},LGraph3ParamNode.prototype.getInputTypesA=function(){return this.intput_typesA?this.intput_typesA:this.T_types},LGraph3ParamNode.prototype.getInputTypesB=function(){return this.intput_typesB?this.intput_typesB:this.T_types},LGraph3ParamNode.prototype.getInputTypesC=function(){return this.intput_typesC?this.intput_typesC:this.T_types},LGraph3ParamNode.prototype.getOutputType=function(){var a=this.output_types?this.output_types:this.T_types;return Object.keys(a)[0]},LGraph3ParamNode.prototype.getScope=function(){return CodePiece.FRAGMENT},LGraph3ParamNode.prototype.getCodeName=function(){return this.code_name},LGraph3ParamNode.prototype.getInputExtraInfoA=function(){return this.in_extra_infoA},LGraph3ParamNode.prototype.getInputExtraInfoB=function(){return this.in_extra_infoB},LGraph3ParamNode.prototype.getInputExtraInfoC=function(){return this.in_extra_infoC},LGraph3ParamNode.prototype.getOutputExtraInfo=function(){return this.out_extra_info},LGraphConstant.title="Number",LGraphConstant.desc="Constant value",LGraphConstant.prototype.setValue=function(a){"string"==typeof a&&(a=parseFloat(a)),this.properties.value=a,this.setDirtyCanvas(!0)},LGraphConstant.prototype.onExecute=function(){this.codes[0]=this.shader_piece.getCode("float_"+this.id,this.properties.value.toFixed(3),CodePiece.FRAGMENT),this.codes[0].order=this.order,this.setOutputData(0,parseFloat(this.properties.value))},LGraphConstant.prototype.onDrawBackground=function(){this.outputs[0].label=this.properties.value.toFixed(3)},LGraphConstant.prototype.onWidget=function(a,b){"value"==b.name&&this.setValue(b.value)},LiteGraph.registerNodeType("constants/"+LGraphConstant.title,LGraphConstant),LGraphTime.title="Time",LGraphTime.desc="Time since execution started",LGraphTime.prototype.onExecute=function(){this.codes[0]=this.shader_piece.getCode(CodePiece.FRAGMENT),this.codes[0].order=this.order},LiteGraph.registerNodeType("constants/"+LGraphTime.title,LGraphTime),LGraphConstVec2.title="ConstVec2",LGraphConstVec2.desc="Constant vector2",LGraphConstVec2.prototype.setFloatValue=function(a,b){"string"==typeof b&&(b=parseFloat(b)),a=b},LGraphConstVec2.prototype.setValue=function(a,b){this.setFloatValue(this.properties.v1,a),this.setFloatValue(this.properties.v2,b),this.setDirtyCanvas(!0)},LGraphConstVec2.prototype.onExecute=function(){this.codes[0]=this.shader_piece.getCode("vec2_"+this.id,this.valueToString(),CodePiece.FRAGMENT),this.codes[0].order=this.order},LGraphConstVec2.prototype.onDrawBackground=function(){this.outputs[0].label=this.valueToString()},LGraphConstVec2.prototype.valueToString=function(){return"vec2("+this.properties.v1.toFixed(3)+","+this.properties.v2.toFixed(3)+")"},LiteGraph.registerNodeType("constants/"+LGraphConstVec2.title,LGraphConstVec2),LGraphConstVec3.title="ConstVec3",LGraphConstVec3.desc="Constant vector3",LGraphConstVec3.prototype.setFloatValue=function(a,b){"string"==typeof b&&(b=parseFloat(b)),a=b},LGraphConstVec3.prototype.setValue=function(a,b,c){this.setFloatValue(this.properties.v1,a),this.setFloatValue(this.properties.v2,b),this.setFloatValue(this.properties.v3,c),this.setDirtyCanvas(!0)},LGraphConstVec3.prototype.onExecute=function(){this.codes[0]=this.shader_piece.getCode("vec3_"+this.id,this.valueToString(),CodePiece.FRAGMENT),this.codes[0].order=this.order},LGraphConstVec3.prototype.onDrawBackground=function(){this.outputs[0].label=this.valueToString()},LGraphConstVec3.prototype.valueToString=function(){return"vec3("+this.properties.v1.toFixed(3)+","+this.properties.v2.toFixed(3)+","+this.properties.v3.toFixed(3)+")"},LiteGraph.registerNodeType("constants/"+LGraphConstVec3.title,LGraphConstVec3),LGraphConstVec4.title="ConstVec4",LGraphConstVec4.desc="Constant vector4",LGraphConstVec4.prototype.setFloatValue=function(a,b){"string"==typeof b&&(b=parseFloat(b)),a=b},LGraphConstVec4.prototype.setValue=function(a,b,c,d){this.setFloatValue(this.properties.v1,a),this.setFloatValue(this.properties.v2,b),this.setFloatValue(this.properties.v3,c),this.setFloatValue(this.properties.v4,d),this.setDirtyCanvas(!0)},LGraphConstVec4.prototype.onExecute=function(){this.codes[0]=this.shader_piece.getCode("vec4_"+this.id,this.valueToString(),CodePiece.FRAGMENT),this.codes[0].order=this.order},LGraphConstVec4.prototype.onDrawBackground=function(){this.outputs[0].label=this.valueToString()},LGraphConstVec4.prototype.valueToString=function(){return"vec4("+this.properties.v1.toFixed(3)+","+this.properties.v2.toFixed(3)+","+this.properties.v3.toFixed(3)+","+this.properties.v4.toFixed(3)+")"},LiteGraph.registerNodeType("constants/"+LGraphConstVec4.title,LGraphConstVec4),LGraphCamToPixelWS.title="CameraToPixelWS",LGraphCamToPixelWS.desc="The vector from camera to pixel",LGraphCamToPixelWS.prototype.onExecute=function(){this.codes[0]=this.shader_piece.getCode(),this.codes[0].order=this.order},LiteGraph.registerNodeType("coordinates/"+LGraphCamToPixelWS.title,LGraphCamToPixelWS),LGraphPixelNormalWS.title="PixelNormalWS",LGraphPixelNormalWS.desc="The normal in world space",LGraphPixelNormalWS.prototype.onExecute=function(){this.codes[0]=this.shader_piece.getCode(),this.codes[0].order=this.order},LiteGraph.registerNodeType("coordinates/"+LGraphPixelNormalWS.title,LGraphPixelNormalWS),LGraphUVs.title="TextureCoords",LGraphUVs.desc="Texture coordinates",LGraphUVs.prototype.onExecute=function(){this.codes[0]=this.shader_piece.getCode(),this.codes[0].order=this.order},LGraphUVs.prototype.setFloatValue=function(a,b){"string"==typeof b&&(b=parseFloat(b)),a=b},LGraphUVs.prototype.setValue=function(a,b){this.setFloatValue(this.properties.UTiling,a),this.setFloatValue(this.properties.VTiling,b)},LiteGraph.registerNodeType("coordinates/"+LGraphUVs.title,LGraphUVs),LGraphVertexPosWS.title="VertexPositionWS",LGraphVertexPosWS.desc="Vertex position in WS",LGraphVertexPosWS.prototype.onExecute=function(){this.codes[0]=this.shader_piece.getCode(),this.codes[0].order=this.order},LiteGraph.registerNodeType("coordinates/"+LGraphVertexPosWS.title,LGraphVertexPosWS),LGraphShader.title="Shader",LGraphShader.desc="Shader Main Node",LGraphShader.prototype.setValue=function(){},LGraphShader.prototype.onExecute=function(){this.processInputCode()},LGraphShader.prototype.onDrawBackground=function(){},LGraphShader.prototype.onWidget=function(){},LGraphShader.prototype.processInputCode=function(){var a=this.getInputCode(0)||LiteGraph.EMPTY_CODE,b=this.getInputCode(1)||LiteGraph.EMPTY_CODE,c=this.getInputCode(2)||LiteGraph.EMPTY_CODE,d=this.shader_piece.createShader(a,b,c);this.graph.shader_output=d;var e=this.graph.findNodesByType("texture/"+LGraphTexture.title);this.graph.shader_textures=[];for(var f=0;f<e.length;++f)this.graph.shader_textures.push(e[f].properties.name);e=this.graph.findNodesByType("texture/"+LGraphCubemap.title);for(var f=0;f<e.length;++f)this.graph.shader_textures.push(e[f].properties.name)},LiteGraph.registerNodeType("core/"+LGraphShader.title,LGraphShader),LGraphTexturePreview.title="Preview",LGraphTexturePreview.desc="Show a texture in the graph canvas",LGraphTexturePreview.prototype.onDrawBackground=function(a){if(!this.flags.collapsed){var b=this.getInputData(0);if(b){var c=null;c=!b.handle&&a.webgl?b:LGraphTexture.generateLowResTexturePreview(b),a.save(),this.properties.flipY&&(a.translate(0,this.size[1]),a.scale(1,-1)),a.drawImage(c,0+.5*LiteGraph.NODE_COLLAPSED_RADIUS,0+.5*LiteGraph.NODE_COLLAPSED_RADIUS,this.size[0]-LiteGraph.NODE_COLLAPSED_RADIUS,this.size[1]-LiteGraph.NODE_COLLAPSED_RADIUS),a.restore()}}},LiteGraph.registerNodeType("texture/"+LGraphTexturePreview.title,LGraphTexturePreview),window.LGraphTexturePreview=LGraphTexturePreview,LGraphTexture.title="TextureSample",LGraphTexture.desc="textureSample",LGraphTexture.widgets_info={name:{widget:"texture"}},LGraphTexture.textures_container={},LGraphTexture.loadTextureCallback=null,LGraphTexture.image_preview_size=256,LGraphTexture.PASS_THROUGH=1,LGraphTexture.COPY=2,LGraphTexture.LOW=3,LGraphTexture.HIGH=4,LGraphTexture.REUSE=5,LGraphTexture.DEFAULT=2,LGraphTexture.MODE_VALUES={"pass through":LGraphTexture.PASS_THROUGH,copy:LGraphTexture.COPY,low:LGraphTexture.LOW,high:LGraphTexture.HIGH,reuse:LGraphTexture.REUSE,"default":LGraphTexture.DEFAULT},LGraphTexture.getTexture=function(a){var b=gl.textures||LGraphTexture.textures_container;if(!b)throw"Cannot load texture, container of textures not found";var c=b[a];if(!c&&a&&":"!=a[0]){if(LGraphTexture.loadTextureCallback){var d=LGraphTexture.loadTextureCallback;return d&&d(a),null}var e=a;"http://"==e.substr(0,7)&&LiteGraph.proxy&&(e=LiteGraph.proxy+e.substr(7)),c=b[a]=GL.Texture.fromURL(e,{})}return c},LGraphTexture.getTargetTexture=function(a,b,c){if(!a)throw"LGraphTexture.getTargetTexture expects a reference texture";var d=null;switch(c){case LGraphTexture.LOW:d=gl.UNSIGNED_BYTE;break;case LGraphTexture.HIGH:d=gl.HIGH_PRECISION_FORMAT;break;case LGraphTexture.REUSE:return a;case LGraphTexture.COPY:default:d=a?a.type:gl.UNSIGNED_BYTE}return b&&b.width==a.width&&b.height==a.height&&b.type==d||(b=new GL.Texture(a.width,a.height,{type:d,format:gl.RGBA,filter:gl.LINEAR})),b},LGraphTexture.getNoiseTexture=function(){if(this._noise_texture)return this._noise_texture;for(var a=new Uint8Array(1048576),b=0;1048576>b;++b)a[b]=255*Math.random();var c=GL.Texture.fromMemory(512,512,a,{format:gl.RGBA,wrap:gl.REPEAT,filter:gl.NEAREST});return this._noise_texture=c,c},LGraphTexture.loadTextureFromFile=function(a,b,c,d,e){if(e=e||window.gl,a){var f=null,g=LiteGraph.removeExtension(b);if("string"==typeof a)e.textures[g]=f=GL.Texture.fromURL(a,{},d,e);else if(-1!=b.toLowerCase().indexOf(".dds"))f=GL.Texture.fromDDSInMemory(a,e);else{var h=new Blob([c]),i=URL.createObjectURL(h);f=GL.Texture.fromURL(i,{},d,e)}return f.name=g,f}},LGraphTexture.prototype.onDropFile=function(a,b,c,d,e){if(a){var f=LGraphTexture.loadTextureFromFile(a,b,c,d,e);f&&(this._drop_texture=f,this._last_tex=this._drop_texture,this.properties.name=f.name,this._drop_texture.current_ctx=LiteGraph.current_ctx)}else this._drop_texture=null,this.properties.name=""},LGraphTexture.prototype.getExtraMenuOptions=function(){var a=this;if(this._drop_texture)return[{content:"Clear",callback:function(){a._drop_texture=null,a.properties.name=""}}]},LGraphTexture.prototype.onExecute=function(){if(this.processInputCode(),this._drop_texture)return this._drop_texture.current_ctx!=LiteGraph.current_ctx&&(this._drop_texture=LGraphTexture.getTexture(this.properties.name)),void this.setOutputData(0,this._drop_texture);if(this.properties.name){var a=LGraphTexture.getTexture(this.properties.name);a&&(this._last_tex=a,this.setOutputData(0,a))}},LGraphTexture.prototype.onDrawBackground=function(a){if(!(this.flags.collapsed||this.size[1]<=20)){if(this._drop_texture&&a.webgl)return void a.drawImage(this._drop_texture,.05*this.size[1],.2*this.size[1],.75*this.size[0],.75*this.size[1]);if(this._last_preview_tex!=this._last_tex)if(a.webgl)this._canvas=this._last_tex;else if(!this._drop_texture||this._drop_texture&&!this._drop_texture.hasOwnProperty("ready")){var b=LGraphTexture.generateLowResTexturePreview(this._last_tex);if(!b)return;this._last_preview_tex=this._last_tex,this._canvas=cloneCanvas(b)}this._canvas&&(a.save(),a.webgl||(a.translate(0,this.size[1]),a.scale(1,-1)),a.drawImage(this._canvas,.05*this.size[1],.2*this.size[1],.75*this.size[0],.75*this.size[1]),a.restore())}},LGraphTexture.generateLowResTexturePreview=function(a){if(!a)return null;var b=LGraphTexture.image_preview_size,c=a;(a.width>b||a.height>b)&&(c=this._preview_temp_tex,this._preview_temp_tex||(c=new GL.Texture(b,b,{minFilter:gl.NEAREST}),this._preview_temp_tex=c),a.copyTo(c),a=c);var d=this._preview_canvas;return d||(d=createCanvas(b,b),this._preview_canvas=d),c&&c.toCanvas(d),d},LGraphTexture.prototype.processInputCode=function(){var a=this.getInputCode(0);if(a){var b="u_"+(this.properties.name?this.properties.name:"default_name")+"_texture",c=this.codes[1]=this.shader_piece.getCode("color_"+this.id,a.getOutputVar(),b);c.order=this.order,c.merge(a);var d=c.clone();d.output_var=c.getOutputVar()+".r",this.codes[2]=d;var e=c.clone();e.output_var=c.getOutputVar()+".g",this.codes[3]=e;var f=c.clone();f.output_var=c.getOutputVar()+".b",this.codes[4]=f;var g=c.clone();g.output_var=c.getOutputVar()+".a",this.codes[5]=g}else this.codes[0]=LiteGraph.EMPTY_CODE,this.codes[1]=LiteGraph.EMPTY_CODE,this.codes[2]=LiteGraph.EMPTY_CODE,this.codes[3]=LiteGraph.EMPTY_CODE,this.codes[4]=LiteGraph.EMPTY_CODE,this.codes[5]=LiteGraph.EMPTY_CODE},LiteGraph.registerNodeType("texture/"+LGraphTexture.title,LGraphTexture),window.LGraphTexture=LGraphTexture,LGraphCubemap.title="TextureSampleCube",LGraphCubemap.desc="textureSampleCube",LGraphCubemap.prototype.onDropFile=function(a,b){if(a){var c=b.split(".")[0];gl.textures[c]=this._drop_texture="string"==typeof a?GL.Texture.cubemapFromURL(a):GL.Texture.fromDDSInMemory(a),this.properties.name=c}else this._drop_texture=null,this.properties.name=""},LGraphCubemap.prototype.onExecute=function(){if(this.processInputCode(),this._drop_texture)return void this.setOutputData(0,this._drop_texture);if(this.properties.name){var a=LGraphTexture.getTexture(this.properties.name);a&&(this._last_tex=a,this.setOutputData(0,a))}},LGraphCubemap.prototype.onDrawBackground=function(){},LGraphCubemap.prototype.processInputCode=function(){var a=this.getInputCode(0);if(a){var b="u_"+(this.properties.name?this.properties.name:"default_name")+"_texture",c=this.codes[1]=this.shader_piece.getCode("color_"+this.id,a.getOutputVar(),b);c.order=this.order,c.merge(a)}else this.codes[0]=LiteGraph.EMPTY_CODE,this.codes[1]=LiteGraph.EMPTY_CODE},LiteGraph.registerNodeType("texture/"+LGraphCubemap.title,LGraphCubemap),window.LGraphCubemap=LGraphCubemap,LGraphVecToComps.title="VecToComps",LGraphVecToComps.desc="Vector To Components",LGraphVecToComps.prototype.onExecute=function(){var a=this.getInputCode(0);if(a){var b=a.clone();b.output_var=a.getOutputVar()+".x",this.codes[0]=b;var c=a.clone();c.output_var=a.getOutputVar()+".y",this.codes[1]=c;var d=a.clone();d.output_var=a.getOutputVar()+".z",this.codes[2]=d;var e=a.clone();e.output_var=a.getOutputVar()+".v",this.codes[4]=e}},LiteGraph.registerNodeType("coordinates/"+LGraphVecToComps.title,LGraphVecToComps),LGraphAbs.prototype=Object.create(LGraph1ParamNode),LGraphAbs.prototype.constructor=LGraphAbs,LGraphAbs.title="Abs",LGraphAbs.desc="Abs of input",LiteGraph.extendClass(LGraphAbs,LGraph1ParamNode),LiteGraph.registerNodeType("math/"+LGraphAbs.title,LGraphAbs),LGraphCos.prototype=Object.create(LGraph1ParamNode),LGraphCos.prototype.constructor=LGraphSin,LGraphCos.title="Cos",LGraphCos.desc="cosine of input",LiteGraph.extendClass(LGraphCos,LGraph1ParamNode),LiteGraph.registerNodeType("math/"+LGraphCos.title,LGraphCos),LGraphSin.prototype=Object.create(LGraph1ParamNode),LGraphSin.prototype.constructor=LGraphSin,LGraphSin.title="Sin",LGraphSin.desc="sine of input",LiteGraph.extendClass(LGraphSin,LGraph1ParamNode),LiteGraph.registerNodeType("math/"+LGraphSin.title,LGraphSin),LGraphOperation.prototype=Object.create(LGraph2ParamNode),LGraphOperation.prototype.constructor=LGraphOperation,LGraphOperation.prototype.onGetNullCode=function(a){return 0==a?this.number_piece.getCode("float_"+this.id,this.properties.A.toFixed(3),CodePiece.FRAGMENT):1==a?this.number_piece.getCode("float_"+this.id,this.properties.B.toFixed(3),CodePiece.FRAGMENT):void 0},LGraphOperation.prototype.onDrawBackground=function(){this.inputs[0].label="A",this.isInputConnected(0)||(this.inputs[0].label+="="+this.properties.A.toFixed(3)),this.inputs[1].label="B",this.isInputConnected(1)||(this.inputs[1].label+="="+this.properties.B.toFixed(3))},LiteGraph.extendClass(LGraphOperation,LGraph2ParamNode),LGraphAddOp.prototype=Object.create(LGraphOperation),LGraphAddOp.prototype.constructor=LGraphAddOp,LGraphAddOp.title="Add",LGraphAddOp.desc="Add the inputs",LiteGraph.extendClass(LGraphAddOp,LGraphOperation),LiteGraph.registerNodeType("operations/"+LGraphAddOp.title,LGraphAddOp),LGraphMix.prototype=Object.create(LGraph3ParamNode),LGraphMix.prototype.constructor=LGraphMix,LGraphMix.title="Mix",LGraphMix.desc="mix of input",LGraphMix.prototype.infereTypes=function(a,b){var c=Object.keys(a.types)[0];if(2!=b||"float"!=c){this.in_conected_using_T++;var d=this.inputs[b];if(d.use_t&&1==this.in_conected_using_T)for(var e in a.types)this.T_types[e]=a.types[e]}},LGraphMix.prototype.onGetNullCode=function(a){return 2==a?this.number_piece.getCode("float_"+this.id,this.properties.alpha.toFixed(3),CodePiece.FRAGMENT):void 0},LGraphMix.prototype.onDrawBackground=function(){this.inputs[2].label="alpha",this.isInputConnected(2)||(this.inputs[2].label+="="+this.properties.alpha.toFixed(3))},LiteGraph.extendClass(LGraphMix,LGraph3ParamNode),LiteGraph.registerNodeType("operations/"+LGraphMix.title,LGraphMix),LGraphMixer.title="Mix",LGraphMixer.desc="Lerp between A and B",LGraphMixer.prototype.onExecute=function(){this.processInputCode()},LGraphMixer.prototype.processInputCode=function(){var a=LiteGraph.EMPTY_CODE,b=this.getInputCode(0),c=this.getInputCode(1),d=this.getInputCode(2),e=d?d.getOutputVar():this.properties.alpha.toFixed(3);b&&c?(a=this.codes[0]=this.shader_piece.getCode("mixed_"+this.id,b.getOutputVar(),c.getOutputVar(),e,CodePiece.FRAGMENT,"vec4"),a.order=this.order,d&&a.merge(d),a.merge(b),a.merge(c)):this.codes[0]=LiteGraph.EMPTY_CODE},LGraphMixer.prototype.onDrawBackground=function(){this.inputs[2].label="alpha",this.isInputConnected(2)||(this.inputs[2].label+="="+this.properties.alpha.toFixed(3))},LGraphMulOp.prototype=Object.create(LGraphOperation),LGraphMulOp.prototype.constructor=LGraphMulOp,LGraphMulOp.title="Mul",LGraphMulOp.desc="Mul the inputs",LiteGraph.extendClass(LGraphMulOp,LGraphOperation),LiteGraph.registerNodeType("operations/"+LGraphMulOp.title,LGraphMulOp),LGraphReflect.title="Reflect",LGraphReflect.desc="To reflect a vector3",LGraphReflect.prototype.onExecute=function(){this.processInputCode()},LGraphReflect.prototype.processInputCode=function(){var a=this.getInputCode(0),b=this.getInputCode(1);if(b&&a){var c=this.codes[0]=this.shader_piece.getCode("reflect_"+this.id,b.getOutputVar(),a.getOutputVar(),CodePiece.FRAGMENT,"vec3");c.order=this.order,c.merge(a),c.merge(b)}else this.codes[0]=LiteGraph.EMPTY_CODE},LiteGraph.registerNodeType("texture/"+LGraphReflect.title,LGraphReflect),LGraphSmooth.title="SmoothStep",LGraphSmooth.desc="Hermite interpolation",LGraphSmooth.prototype.onExecute=function(){this.processInputCode()},LGraphSmooth.prototype.processInputCode=function(){var a=this.getInputCode(0),b=this.getInputCode(1),c=this.getInputCode(2),d=a?a.getOutputVar():this.properties.lower.toFixed(3),e=b?b.getOutputVar():this.properties.upper.toFixed(3),f=c?c.getOutputVar():"0.0",g=this.codes[0]=this.shader_piece.getCode("smoothed_"+this.id,d,e,f);g.order=this.order,c?(g.merge(c),a&&g.merge(a),b&&g.merge(b)):g=LiteGraph.EMPTY_CODE},LGraphSmooth.prototype.onDrawBackground=function(){this.inputs[0].label="lower",this.isInputConnected(0)||(this.inputs[0].label+="="+this.properties.lower.toFixed(3)),this.inputs[1].label="upper",this.isInputConnected(0)||(this.inputs[1].label+="="+this.properties.upper.toFixed(3))},LiteGraph.registerNodeType("texture/"+LGraphSmooth.title,LGraphSmooth);